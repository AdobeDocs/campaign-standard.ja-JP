---
title: スケジュールされたワークフローの重複実行
description: スケジュールされたワークフローが重複して実行されるのを防ぐ方法を説明します。
audience: automating
content-type: reference
topic-tags: workflow-general-operation
context-tags: workflow,overview;workflow,main
feature: Workflows
role: Data Architect
level: Intermediate
exl-id: 8d9820a4-3c44-45f5-815e-4ed48a96276d
source-git-commit: fcb5c4a92f23bdffd1082b7b044b5859dead9d70
workflow-type: tm+mt
source-wordcount: '422'
ht-degree: 1%

---

# スケジュールされたワークフローの重複実行{#preventing-overlapping-execution-of-scheduled-workflows}

## スケジュールされたワークフローの実行について

Campaign Standardでは、ワークフローエンジンは、1つのプロセスでのみ1つのワークフローインスタンスが実行されることを保証します。 インポート、長時間実行されるクエリ、データベースへの書き込みなどのアクティビティをブロックすると、実行時に他のタスクが実行されなくなります。

一方、ノンブロッキングアクティビティは、他のタスク（通常は&#x200B;**[!UICONTROL Scheduler]**&#x200B;アクティビティなどのイベントを待機しているアクティビティ）の実行をブロックしません。

これにより、同じワークフローの前回の実行が完了していない場合でも、スケジュールベースのワークフローの実行が開始し、予期しないデータの問題が発生する可能性があります。

したがって、複数のアクティビティを含むスケジュール済みワークフローをデザインする場合は、完了するまでワークフローのスケジュールが再設定されないようにする必要があります。 これをおこなうには、以前の実行の1つ以上のタスクがまだ保留中の場合に、ワークフローの実行を防ぐようにワークフローを設定する必要があります。

## ワークフローの設定

前回のワークフロー実行の1つ以上のタスクが保留中かどうかを確認するには、**[!UICONTROL Query]**&#x200B;と&#x200B;**[!UICONTROL Test]**&#x200B;アクティビティを使用する必要があります。

1. **[!UICONTROL Scheduler]**&#x200B;アクティビティの後に&#x200B;**[!UICONTROL Query]**&#x200B;アクティビティを追加し、次のように設定します。

1. アクティビティのリソースを&#x200B;**[!UICONTROL WorkflowTaskDetail]**&#x200B;に変更します。つまり、ワークフローの現在のタスクをターゲットにします。

   ![](assets/scheduled-wkf-resource.png)

1. 次のルールを使用してクエリを設定します。

   ![](assets/scheduled-wkf-query.png)

   * 最初のルールは、現在のタスク（クエリ2）と、現在のワークフローに属する次のスケジュールタスク（スケジュール2）を除外します。

      >[!NOTE]
      >
      >**[!UICONTROL Scheduler]**&#x200B;アクティビティが開始すると、すぐに次のスケジュール時刻に実行する別のスケジュールタスクが追加され、ワークフローが開始されます。 したがって、前回の実行から保留中のタスクを検索する際に、クエリとスケジュールの両方をフィルタリングすることが重要です。

   * 2つ目のルールは、前回のワークフロー実行のタスクが、0個の実行ステータスに対応するアクティブ（保留中）であるかどうかを判定します。

1. **[!UICONTROL Query]**&#x200B;アクティビティが返す保留中のタスクの数を確認するために、**[!UICONTROL Test]**&#x200B;アクティビティを追加します。 これをおこなうには、2つのアウトバウンドトランジションを設定します。

   ![](assets/scheduled-wkf-test.png)

   * 保留中のタスクがない場合、最初のトランジションはワークフローの実行を継続します。
   * 2つ目のトランジションでは、保留中のタスクがある場合にワークフローの実行がキャンセルされます。

   ![](assets/scheduled-wkf-workflow.png)

これで、必要に応じて残りのワークフローを設定できます。 保留中のタスクが原因でワークフローの実行がキャンセルされた場合、スケジュールに従ってワークフローが再び実行されると、これらの手順を実行できます。 これにより、前回の実行からアクティブな（保留中の）タスクがない場合にのみ、ワークフローの実行が続行されます。
